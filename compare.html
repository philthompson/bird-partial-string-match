<!DOCTYPE html>
<html>
<body style="padding: 2.0rem; font-size: 1.25rem">
    <!-- checklist parsed from https://ebird.org/printableList?regionCode=US-OR-039&yr=all&m= -->
    <pre id="birds-list" style="display:none">
Acanthis/Spinus sp.
Accipiter sp.
Acorn Woodpecker
American Avocet
American Bittern
American Coot
American Crow
American Dipper
American Golden-Plover
American Goldfinch
American Kestrel
American Pipit
American Redstart
American Robin
American Three-toed Woodpecker
American Three-toed/Black-backed Woodpecker
American Tree Sparrow
American White Pelican
American Wigeon
American Wigeon x Mallard (hybrid)
American/Pacific Golden-Plover (Lesser Golden-Plover)
Ancient Murrelet
Anna's Hummingbird
Anna's x Rufous Hummingbird (hybrid)
Arctic Tern
Ash-throated Flycatcher
Aythya sp.
Baikal Teal
Baird's Sandpiper
Bald Eagle
Baltimore Oriole
Band-tailed Pigeon
Bank Swallow
Bar-tailed Godwit
Barn Owl
Barn Swallow
Barred Owl
Barrow's Goldeneye
Belted Kingfisher
Bewick's Wren
Black Oystercatcher
Black Phoebe
Black Scoter
Black Swift
Black Tern
Black Turnstone
Black-and-white Warbler
Black-backed Woodpecker
Black-bellied Plover
Black-bellied Plover/golden-plover sp.
Black-capped Chickadee
Black-chinned Hummingbird
Black-chinned x Rufous Hummingbird (hybrid)
Black-crowned Night-Heron
Black-footed Albatross
Black-headed Grosbeak
Black-legged Kittiwake
Black-necked Stilt
Black-throated Gray Warbler
Black-throated Gray/Hermit Warbler
Black-throated Gray/Townsend's Warbler
Black-throated Green Warbler
Black-throated Sparrow
Black-vented Shearwater
Blackpoll Warbler
Blue Grosbeak
Blue Jay
Blue-gray Gnatcatcher
Blue-winged Teal
Blue-winged/Cinnamon Teal
Bobolink
Bohemian Waxwing
Bonaparte's Gull
Boreal Owl
Brambling
Brandt's Cormorant
Brant
Brewer's Blackbird
Brewer's Sparrow
Brown Booby
Brown Creeper
Brown Pelican
Brown Thrasher
Brown-headed Cowbird
Budgerigar
Buff-breasted Sandpiper
Bufflehead
Bufflehead x Common Goldeneye (hybrid)
Buller's Shearwater
Bullock's Oriole
Burrowing Owl
Bushtit
Buteo sp.
Cackling Goose
Cackling/Canada Goose
Calidris sp.
California Gull
California Quail
California Scrub-Jay
California/Woodhouse's Scrub-Jay
Calliope Hummingbird
Canada Goose
Canada Jay
Canvasback
Caspian Tern
Cassin's Auklet
Cassin's Finch
Cassin's Sparrow
Cassin's Vireo
Catharus sp.
Cattle Egret
Cedar Waxwing
Chestnut-backed Chickadee
Chestnut-collared Longspur
Chestnut-sided Warbler
Chimney Swift
Chimney/Vaux's Swift
Chipping Sparrow
Chukar
Cinnamon Teal
Clark's Grebe
Clark's Nutcracker
Clay-colored Sparrow
Cliff Swallow
Cockatiel
Common Goldeneye
Common Goldeneye x Hooded Merganser (hybrid)
Common Grackle
Common Loon
Common Merganser
Common Murre
Common Nighthawk
Common Poorwill
Common Raven
Common Redpoll
Common Tern
Common Yellowthroat
Common/Arctic Tern
Common/Barrow's Goldeneye
Common/Red-breasted Merganser
Cook's Petrel
Cookilaria petrel sp.
Cooper's Hawk
Costa's Hummingbird
Curlew Sandpiper
Dark-eyed Junco
Dickcissel
Domestic goose sp. (Domestic type)
Domestic goose sp. x Canada Goose (hybrid)
Double-crested Cormorant
Downy Woodpecker
Downy/Hairy Woodpecker
Dunlin
Dusky Flycatcher
Dusky Warbler
Eared Grebe
Eastern Kingbird
Eastern Yellow Wagtail
Elegant Tern
Emperor Goose
Empidonax sp.
Eurasian Collared-Dove
Eurasian Dotterel
Eurasian Wigeon
Eurasian x American Wigeon (hybrid)
European Starling
Evening Grosbeak
Falcated Duck
Ferruginous Hawk
Flammulated Owl
Flesh-footed Shearwater
Fork-tailed Storm-Petrel
Forster's Tern
Fox Sparrow
Franklin's Gull
Gadwall
Gadwall x Mallard (hybrid)
Galapagos/Hawaiian Petrel (Dark-rumped Petrel)
Glaucous Gull
Glaucous-winged Gull
Glaucous-winged x Glaucous Gull (hybrid)
Glossy/White-faced Ibis
Golden Eagle
Golden-crowned Kinglet
Golden-crowned Sparrow
Grasshopper Sparrow
Gray Catbird
Gray Flycatcher
Gray-crowned Rosy-Finch
Graylag Goose
Graylag x Canada Goose (hybrid)
Graylag x Swan Goose (hybrid)
Great Blue Heron
Great Egret
Great Gray Owl
Great Horned Owl
Great-tailed Grackle
Great/Intermediate Egret
Greater Scaup
Greater White-fronted Goose
Greater White-fronted x Canada Goose (hybrid)
Greater Yellowlegs
Greater/Lesser Scaup
Greater/Lesser Yellowlegs
Green Heron
Green-tailed Towhee
Green-winged Teal
Gyrfalcon
Haemorhous sp.
Hairy Woodpecker
Hammond's Flycatcher
Hammond's/Dusky Flycatcher
Harlequin Duck
Harris's Sparrow
Hawaiian Petrel
Heermann's Gull
Hermit Thrush
Hermit Warbler
Herring Gull
Herring x Glaucous-winged Gull (hybrid)
Herring/Iceland Gull
Hooded Merganser
Hooded Oriole
Hooded Warbler
Horned Grebe
Horned Lark
Horned Puffin
Horned/Eared Grebe
House Finch
House Sparrow
House Wren
House/Purple Finch
Hudsonian Godwit
Hutton's Vireo
Iceland Gull
Indian Peafowl
Indigo Bunting
Jack Snipe
Killdeer
King Eider
King/Common Eider
Lapland Longspur
Lark Bunting
Lark Sparrow
Larus sp.
Lawrence's Goldfinch
Laysan Albatross
Lazuli Bunting
Lazuli x Indigo Bunting (hybrid)
Lazuli/Indigo Bunting
LeConte's Sparrow
Leach's Storm-Petrel
Least Flycatcher
Least Sandpiper
Lesser Black-backed Gull
Lesser Goldfinch
Lesser Scaup
Lesser Yellowlegs
Lesser x American Goldfinch (hybrid)
Lewis's Woodpecker
Lincoln's Sparrow
Little Gull
Loggerhead Shrike
Long-billed Curlew
Long-billed Dowitcher
Long-eared Owl
Long-tailed Duck
Long-tailed Jaeger
Lucy's Warbler
MacGillivray's Warbler
Magnificent Frigatebird
Magnolia Warbler
Mallard
Manx Shearwater
Marbled Godwit
Marbled Murrelet
Marsh Wren
Merlin
Mottled Petrel
Mountain Bluebird
Mountain Chickadee
Mountain Plover
Mountain Quail
Mourning Dove
Mourning Warbler
Murphy's Petrel
Muscovy Duck
Mute Swan
Nashville Warbler
Northern Bobwhite
Northern Flicker
Northern Fulmar
Northern Goshawk
Northern Harrier
Northern Mockingbird
Northern Parula
Northern Pintail
Northern Pygmy-Owl
Northern Rough-winged Swallow
Northern Saw-whet Owl
Northern Shoveler
Northern Shrike
Northern Waterthrush
Olive-sided Flycatcher
Orange-crowned Warbler
Orchard Oriole
Oriental Greenfinch
Osprey
Ovenbird
Pacific Golden-Plover
Pacific Loon
Pacific Wren
Pacific-slope Flycatcher
Pacific-slope/Cordilleran Flycatcher (Western Flycatcher)
Pacific/Winter Wren
Palm Warbler
Parakeet Auklet
Parasitic Jaeger
Pectoral Sandpiper
Pelagic Cormorant
Peregrine Falcon
Pied-billed Grebe
Pigeon Guillemot
Pileated Woodpecker
Pine Grosbeak
Pine Siskin
Pink-footed Shearwater
Piping Plover
Pomarine Jaeger
Pomarine/Parasitic Jaeger
Prairie Falcon
Prairie Warbler
Purple Finch
Purple Martin
Purple/Cassin's Finch
Pygmy Nuthatch
Red Crossbill
Red Junglefowl
Red Knot
Red Phalarope
Red-bellied Woodpecker
Red-billed Tropicbird
Red-breasted Merganser
Red-breasted Nuthatch
Red-breasted Sapsucker
Red-eyed Vireo
Red-naped Sapsucker
Red-naped x Red-breasted Sapsucker (hybrid)
Red-naped/Red-breasted Sapsucker
Red-necked Grebe
Red-necked Phalarope
Red-necked Stint
Red-necked/Red Phalarope
Red-shouldered Hawk
Red-tailed Hawk
Red-throated Loon
Red-throated Pipit
Red-winged Blackbird
Redhead
Rhinoceros Auklet
Ring-billed Gull
Ring-necked Duck
Ring-necked Pheasant
Rock Pigeon
Rock Sandpiper
Rock Wren
Rose-breasted Grosbeak
Rose-breasted x Black-headed Grosbeak (hybrid)
Ross's Goose
Rough-legged Hawk
Ruby-crowned Kinglet
Ruby-crowned/Golden-crowned Kinglet
Ruddy Duck
Ruddy Turnstone
Ruff
Ruffed Grouse
Rufous Hummingbird
Rufous/Allen's Hummingbird
Rustic Bunting
Rusty Blackbird
Sabine's Gull
Sage Thrasher
Sagebrush Sparrow
Sagebrush/Bell's Sparrow (Sage Sparrow)
Sanderling
Sandhill Crane
Savannah Sparrow
Say's Phoebe
Scaly-breasted Munia
Scolopacidae sp.
Scripps's Murrelet
Scripps's/Craveri's Murrelet
Sedge Wren
Semipalmated Plover
Semipalmated Sandpiper
Sharp-shinned Hawk
Sharp-shinned/Cooper's Hawk
Sharp-tailed Sandpiper
Short-billed Dowitcher
Short-billed Gull
Short-billed/Long-billed Dowitcher
Short-eared Owl
Short-tailed Albatross
Short-tailed Shearwater
Slaty-backed Gull
Smith's Longspur
Snow Bunting
Snow Goose
Snow x Ross's Goose (hybrid)
Snow/Ross's Goose
Snowy Egret
Snowy Owl
Snowy Plover
Solitary Sandpiper
Song Sparrow
Sooty Grouse
Sooty Shearwater
Sooty/Short-tailed Shearwater
Sora
South Polar Skua
Spinus sp.
Spizella sp.
Spotted Owl
Spotted Redshank
Spotted Sandpiper
Spotted Towhee
Spotted x Barred Owl (hybrid)
Steller's Eider
Steller's Jay
Sterna sp.
Stilt Sandpiper
Streaked Shearwater
Summer Tanager
Surf Scoter
Surf/Black Scoter
Surfbird
Swainson's Hawk
Swainson's Thrush
Swamp Sparrow
Swan Goose
Swan Goose x Canada Goose (hybrid)
Tennessee Warbler
Thick-billed Murre
Townsend's Solitaire
Townsend's Warbler
Townsend's x Hermit Warbler (hybrid)
Townsend's/Hermit Warbler
Tree Swallow
Tree/Violet-green Swallow
Tricolored Blackbird
Tropical Kingbird
Trumpeter Swan
Trumpeter/Tundra Swan
Tufted Duck
Tufted Puffin
Tundra Swan
Turkey Vulture
Upland Sandpiper
Varied Thrush
Vaux's Swift
Vermilion Flycatcher
Vesper Sparrow
Violet-green Swallow
Virginia Rail
Virginia's Warbler
Wandering Tattler
Warbling Vireo
Western Bluebird
Western Grebe
Western Gull
Western Kingbird
Western Meadowlark
Western Sandpiper
Western Screech-Owl
Western Tanager
Western Wood-Pewee
Western x Glaucous-winged Gull (hybrid)
Western/Clark's Grebe
Western/Glaucous-winged Gull
Whimbrel
White Wagtail
White-breasted Nuthatch
White-crowned Sparrow
White-crowned x Golden-crowned Sparrow (hybrid)
White-faced Ibis
White-headed Woodpecker
White-tailed Kite
White-throated Sparrow
White-throated Swift
White-winged Crossbill
White-winged Dove
White-winged Scoter
Wild Turkey
Willet
Williamson's Sapsucker
Willow Flycatcher
Wilson's Phalarope
Wilson's Snipe
Wilson's Warbler
Winter Wren
Wood Duck
Wood Sandpiper
Wrentit
Yellow Warbler
Yellow-bellied Sapsucker
Yellow-bellied/Red-naped Sapsucker
Yellow-billed Loon
Yellow-breasted Chat
Yellow-headed Blackbird
Yellow-rumped Warbler
Yellow-throated Warbler
Zonotrichia sp.
alcid sp.
auklet sp.
bird sp.
black-and-white shearwater sp.
blackbird sp.
chickadee sp.
cormorant sp.
crossbill sp.
crow/raven sp.
dabbling duck sp.
diurnal raptor sp.
duck sp.
falcon sp.
finch sp.
golden-plover sp.
goose sp.
grebe sp.
grouse sp.
gull sp.
hawk sp.
heron sp.
hummingbird sp.
jaeger sp.
jay sp.
large falcon sp.
large shorebird sp.
longspur sp.
loon sp.
merganser sp.
murrelet sp.
new world flycatcher sp.
new world goldfinch sp.
new world oriole sp.
new world quail sp.
new world sparrow sp.
new world warbler sp.
nuthatch sp.
owl sp.
passerine sp.
peep sp.
phalarope sp.
phoebe sp.
pigeon/dove sp.
plover sp.
rail/crake sp.
sapsucker sp.
scoter sp.
shearwater sp.
shorebird sp.
small falcon sp.
small swift sp.
solitary vireo sp.
storm-petrel sp.
storm-petrel sp. (dark-rumped)
swallow sp.
swan sp.
swift sp.
teal sp.
tern sp.
thrush sp.
vireo sp.
waterfowl sp.
white egret sp.
woodpecker sp.
wren sp.</pre>
    <p>Type into the box to search the <a target="_blank" href="https://ebird.org/printableList?regionCode=US-OR-039&yr=all&m=">Lane County bird checklist</a>.</p>
    <p>The search algorithm can be changed with the select box to see how the results differ.</p>
    <select id="algo">
        <option value="prefix">Simple Prefix</option>
        <option value="levenshtein-prefix">Levenshtein Distance of Prefix</option>
        <option value="levenshtein-substring">Levenshtein Distance of Substring</option>
    </select><br/>
    <br/>
    <input id="text" width="30" style="padding: 0.25rem"/><input id="lev-score" type="checkbox" />show Levenshtein dist.
    <div id="results" style="padding-top: 1.0rem"></div>
    <script type="text/javascript">
    const algoSelect = document.getElementById("algo");
    const textInput = document.getElementById("text");
    const resultsDiv = document.getElementById("results");
    const levDistCb = document.getElementById("lev-score");

    // Acanthis/Spinus sp. --> [ "Acanthis", "Spinus", "sp." ]
    // Black-throated Gray/Hermit Warbler --> [ "Black", "throated", "Gray", "Hermit", "Warbler" ]
    // Steller's Jay --> [ "Steller's", "Jay" ]
    const splitRegex = /[^A-Za-z'.]+/;
    // one bird name per line, then each bird name is split into a set of component words
    const allBirds = {};
    for (const bird of document.getElementById("birds-list").innerHTML.split("\n")) {
        const lowerBird = bird.toLocaleLowerCase();
        // split by non-alpha and also just by space (to include entire hyphenated words and words in (parens))
        allBirds[bird] = new Set(
            lowerBird.split(splitRegex).concat(lowerBird.split(' '))
        );
        allBirds[bird].delete('');
        allBirds[bird].add(lowerBird);
    }

    // - case-insensitive search for word prefixes
    const doPrefixSearch = function(e) {
        const searchText = textInput.value.trim().toLocaleLowerCase();
        if (searchText.length < 1) {
            resultsDiv.innerHTML = "";
            return;
        }
        const results = [];
        for (const bird in allBirds) {
            for (const birdWord of allBirds[bird]) {
                if (birdWord.startsWith(searchText)) {
                    results.push(bird);
                    break;
                }
            }
        }
        if (results.length === 0) {
            results.push("(no results)");
        }
        resultsDiv.innerHTML = results.join("<br/>");
    };

    // implemented from pseudocode at https://en.wikipedia.org/wiki/Levenshtein_distance
    const levenshteinDistance = function(query, target) {
        // array of arrays: dist[source-prefix][target-prefix]
        let dist = [];
        for (let i = 0; i < query.length+1; i++) {
            // for each length of prefix of query, create an array of length of
            //   the target, and fill with zeros
            dist.push(Array(target.length+1).fill(0,0));
        }
        for (let i = 1; i < query.length+1; i++) {
            dist[i][0] = i;
        }
        for (let j = 1; j < target.length+1; j++) {
            dist[0][j] = j;
        }
        let substitutionCost;
        for (let j = 1; j < target.length+1; j++) {
            for (let i = 1; i < query.length+1; i++) {
                if (query[i-1] === target[j-1]) {
                    substitutionCost = 0;
                } else {
                    substitutionCost = 1;
                }
                dist[i][j] = Math.min(
                    dist[i-1][j] + 1,                 // deletion
                    dist[i][j-1] + 1,                 // insertion
                    dist[i-1][j-1] + substitutionCost // substitution
                );
            }
        }
        return dist[query.length][target.length];
    }

    // - does a levenshtein distance score for each word in each bird name,
    //     where the target word is truncated to a prefix of the same length
    //     as the search term
    // - returns only the top N results (set to 16)
    const doLevenshteinPrefixSearch = function(e) {
        const searchText = textInput.value.trim().toLocaleLowerCase();
        if (searchText.length < 1) {
            resultsDiv.innerHTML = "";
            return;
        }
        const resultsToReturn = 16;
        let uniqueResults = new Set();
        let worstDisplayedScore = -1;
        // dict of arrays: matches by score:
        //   results[0] = array of exact matches
        //   results[1] = array of "matches" with levenshtein distance of 1
        const results = {};
        let dist;
        for (const bird in allBirds) {
            for (const birdWord of allBirds[bird]) {
                dist = levenshteinDistance(searchText, birdWord.substring(0, searchText.length));
                if (uniqueResults.size < resultsToReturn || worstDisplayedScore === -1 || dist < worstDisplayedScore) {
                    if (!results.hasOwnProperty(dist)) {
                        results[dist] = [];
                    }
                    results[dist].push(bird);
                    console.log("added", bird, "to results with distance", dist, "for its word", birdWord);
                    uniqueResults.add(bird);
                    if (dist > worstDisplayedScore) {
                        worstDisplayedScore = dist;
                    }
                    if (uniqueResults.size > resultsToReturn) {
                        let newWorstDisplayedScore = -1;
                        uniqueResults.clear();
                        for (let i = 0; i <= worstDisplayedScore && uniqueResults.size < resultsToReturn; i++) {
                            if (results.hasOwnProperty(i)) {
                                newWorstDisplayedScore = i;
                                results[i].forEach(uniqueResults.add, uniqueResults);
                            }
                        }
                        worstDisplayedScore = newWorstDisplayedScore;
                    }
                    //break; // don't break, since a multi-word bird may have better score for word 2 than word 1
                } else {
                    //console.log(birdWord, "of", bird, "has dist", dist, "and thus is disqualified");
                }
            }
            // don't break, since a later bird may have better score
            //if (uniqueResults.size >= resultsToReturn) {
            //    break;
            //}
        }
        // if multiple words in a bird's name are matches with a low enough
        //   score to be displayed, we don't want to display that bird more
        //   than once
        // since we want the output ordered by best score, and the output
        //   will be very short (10 or 20 results or so) we can just use
        //   array.indexOf() to include only unique results
        let orderedResults = [];
        for (let i = 0; i <= worstDisplayedScore && orderedResults.length < resultsToReturn; i++) {
            if (results.hasOwnProperty(i)) {
                for (const match of results[i]) {
                    const scoreMatch = levDistCb.checked ? "<small>" + i + "</small>: " + match : match;
                    if (orderedResults.indexOf(scoreMatch) == -1) {
                        orderedResults.push(scoreMatch);
                    }
                }
            }
        }
        resultsDiv.innerHTML = orderedResults.join("<br/>");
    }

    // - does a levenshtein distance score for each substring in the bird name
    //     with the same length as the given search term
    // - returns only the top N results (set to 16)
    const doLevenshteinSubstringSearch = function(e) {
        const searchText = textInput.value.trim().toLocaleLowerCase();
        if (searchText.length < 1) {
            resultsDiv.innerHTML = "";
            return;
        }
        const resultsToReturn = 16;
        let uniqueResults = new Set();
        let worstDisplayedScore = -1;
        // dict of arrays: matches by score:
        //   results[0] = array of exact matches
        //   results[1] = array of "matches" with levenshtein distance of 1
        const results = {};
        let dist;
        let bestSubstringDist;
        for (const bird in allBirds) {
            const lowerBird = bird.toLocaleLowerCase();
            bestSubstringDist = -1;
            for (let leftOffset = 0; leftOffset < lowerBird.length; leftOffset++) {
                dist = levenshteinDistance(searchText, lowerBird.substring(leftOffset, leftOffset + searchText.length));
                if (bestSubstringDist === -1 || dist < bestSubstringDist) {
                    bestSubstringDist = dist;
                }
                // put this check at the end of the loop, to ensure it runs at least once
                if (leftOffset + searchText.length >= lowerBird.length) {
                    break;
                }
            }
            if (uniqueResults.size < resultsToReturn || worstDisplayedScore === -1 || bestSubstringDist < worstDisplayedScore) {
                if (!results.hasOwnProperty(bestSubstringDist)) {
                    results[bestSubstringDist] = [];
                }
                results[bestSubstringDist].push(bird);
                console.log("added", bird, "to results with distance", dist, "for some substring");
                uniqueResults.add(bird);
                if (bestSubstringDist > worstDisplayedScore) {
                    worstDisplayedScore = bestSubstringDist;
                }
                if (uniqueResults.size > resultsToReturn) {
                    let newWorstDisplayedScore = -1;
                    uniqueResults.clear();
                    for (let i = 0; i <= worstDisplayedScore && uniqueResults.size < resultsToReturn; i++) {
                        if (results.hasOwnProperty(i)) {
                            newWorstDisplayedScore = i;
                            results[i].forEach(uniqueResults.add, uniqueResults);
                        }
                    }
                    worstDisplayedScore = newWorstDisplayedScore;
                }
            }
        }
        // since we want the output ordered by best score, and the output
        //   will be very short (10 or 20 results or so) we can just use
        //   array.indexOf() to include only unique results
        let orderedResults = [];
        for (let i = 0; i <= worstDisplayedScore && orderedResults.length < resultsToReturn; i++) {
            if (results.hasOwnProperty(i)) {
                for (const match of results[i]) {
                    const scoreMatch = levDistCb.checked ? "<small>" + i + "</small>: " + match : match;
                    if (orderedResults.indexOf(scoreMatch) == -1) {
                        orderedResults.push(scoreMatch);
                    }
                }
            }
        }
        resultsDiv.innerHTML = orderedResults.join("<br/>");
    }

    let selectedSearchFunction = doPrefixSearch;

    const setSearchFunction = function() {
        selectedSearchFunction = doPrefixSearch;
        if (algoSelect.value === "levenshtein-prefix") {
            selectedSearchFunction = doLevenshteinPrefixSearch;
        } else if (algoSelect.value === "levenshtein-substring") {
            selectedSearchFunction = doLevenshteinSubstringSearch;
        }
        selectedSearchFunction();
    }

    algoSelect.addEventListener("change", setSearchFunction);
    // call it here because when the page is re-loaded, the
    //   <select> box and <input> may still contain a query
    setSearchFunction();

    textInput.addEventListener("change", function() {
        //console.log("text change");
        selectedSearchFunction();
    });
    textInput.addEventListener("input", function() {
        //console.log("text input");
        selectedSearchFunction();
    });

    levDistCb.addEventListener("change", function(e) {
        selectedSearchFunction();
    });

    </script>
</body>
</html>